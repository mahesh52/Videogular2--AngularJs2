"use strict";
var core_1 = require("@angular/core");
var vg_fullscreen_api_1 = require("./vg-fullscreen-api");
var vg_utils_1 = require("./vg-utils");
describe('Videogular Player', function () {
    var medias;
    var elem;
    beforeEach(function () {
        medias = new core_1.QueryList();
        elem = {
            webkitRequestFullscreen: function () { }
        };
        vg_fullscreen_api_1.VgFullscreenAPI.isAvailable = true;
        vg_fullscreen_api_1.VgFullscreenAPI.nativeFullscreen = true;
        vg_fullscreen_api_1.VgFullscreenAPI.init(elem, medias);
    });
    it('Should create polyfills on init', function () {
        expect(vg_fullscreen_api_1.VgFullscreenAPI.polyfill.enabled).toBe('webkitFullscreenEnabled');
        expect(vg_fullscreen_api_1.VgFullscreenAPI.polyfill.element).toBe('webkitFullscreenElement');
        expect(vg_fullscreen_api_1.VgFullscreenAPI.polyfill.request).toBe('webkitRequestFullscreen');
        expect(vg_fullscreen_api_1.VgFullscreenAPI.polyfill.exit).toBe('webkitExitFullscreen');
        expect(vg_fullscreen_api_1.VgFullscreenAPI.polyfill.onchange).toBe('webkitfullscreenchange');
        expect(vg_fullscreen_api_1.VgFullscreenAPI.polyfill.onerror).toBe('webkitfullscreenerror');
    });
    it('Should request an element to enter in fullscreen mode (desktop)', function () {
        spyOn(vg_fullscreen_api_1.VgFullscreenAPI, 'enterElementInFullScreen').and.callFake(function () { });
        vg_fullscreen_api_1.VgFullscreenAPI.request(null);
        expect(vg_fullscreen_api_1.VgFullscreenAPI.isFullscreen).toBeTruthy();
        expect(vg_fullscreen_api_1.VgFullscreenAPI.enterElementInFullScreen).toHaveBeenCalledWith(elem);
    });
    it('Should request an element to enter in fullscreen mode (mobile)', function () {
        spyOn(vg_utils_1.VgUtils, 'isMobileDevice').and.callFake(function () { return true; });
        spyOn(vg_fullscreen_api_1.VgFullscreenAPI, 'enterElementInFullScreen').and.callFake(function () { });
        vg_fullscreen_api_1.VgFullscreenAPI.request(null);
        expect(vg_fullscreen_api_1.VgFullscreenAPI.isFullscreen).toBeTruthy();
        expect(vg_utils_1.VgUtils.isMobileDevice).toHaveBeenCalled();
        expect(vg_fullscreen_api_1.VgFullscreenAPI.enterElementInFullScreen).toHaveBeenCalledWith(elem);
    });
    it('Should request an element to enter in fullscreen mode (mobile with param elem)', function () {
        spyOn(vg_utils_1.VgUtils, 'isMobileDevice').and.callFake(function () { return true; });
        spyOn(vg_fullscreen_api_1.VgFullscreenAPI, 'enterElementInFullScreen').and.callFake(function () { });
        vg_fullscreen_api_1.VgFullscreenAPI.request(elem);
        expect(vg_fullscreen_api_1.VgFullscreenAPI.isFullscreen).toBeTruthy();
        expect(vg_utils_1.VgUtils.isMobileDevice).toHaveBeenCalled();
        expect(vg_fullscreen_api_1.VgFullscreenAPI.enterElementInFullScreen).toHaveBeenCalledWith(elem);
    });
    it('Should not request an element to enter in fullscreen mode', function () {
        spyOn(vg_fullscreen_api_1.VgFullscreenAPI, 'enterElementInFullScreen').and.callFake(function () { });
        vg_fullscreen_api_1.VgFullscreenAPI.nativeFullscreen = false;
        vg_fullscreen_api_1.VgFullscreenAPI.request(elem);
        expect(vg_fullscreen_api_1.VgFullscreenAPI.enterElementInFullScreen).not.toHaveBeenCalled();
    });
    it('Should enter in fullscreen mode', function () {
        spyOn(elem, 'webkitRequestFullscreen').and.callThrough();
        vg_fullscreen_api_1.VgFullscreenAPI.enterElementInFullScreen(elem);
        expect(elem.webkitRequestFullscreen).toHaveBeenCalled();
    });
    it('Should request an element to exit from fullscreen mode (native)', function () {
        vg_fullscreen_api_1.VgFullscreenAPI.polyfill.exit = 'mockedExitFunction';
        document.mockedExitFunction = function () { };
        spyOn(document, 'mockedExitFunction').and.callThrough();
        vg_fullscreen_api_1.VgFullscreenAPI.exit();
        expect(vg_fullscreen_api_1.VgFullscreenAPI.isFullscreen).toBeFalsy();
        expect(document.mockedExitFunction).toHaveBeenCalled();
    });
    it('Should request an element to exit from fullscreen mode (emulated)', function () {
        vg_fullscreen_api_1.VgFullscreenAPI.polyfill.exit = 'mockedExitFunction';
        document.mockedExitFunction = function () { };
        spyOn(document, 'mockedExitFunction').and.callThrough();
        vg_fullscreen_api_1.VgFullscreenAPI.nativeFullscreen = false;
        vg_fullscreen_api_1.VgFullscreenAPI.exit();
        expect(vg_fullscreen_api_1.VgFullscreenAPI.isFullscreen).toBeFalsy();
        expect(document.mockedExitFunction).not.toHaveBeenCalled();
    });
    it('Should enter videogular element to fullscreen mode', function () {
        vg_fullscreen_api_1.VgFullscreenAPI.videogularElement = { id: 'vgElem' };
        spyOn(vg_fullscreen_api_1.VgFullscreenAPI, 'request').and.callFake(function () { });
        vg_fullscreen_api_1.VgFullscreenAPI.toggleFullscreen();
        expect(vg_fullscreen_api_1.VgFullscreenAPI.request).toHaveBeenCalledWith(null);
    });
    it('Should enter other element to fullscreen mode', function () {
        var element = { id: 'main' };
        vg_fullscreen_api_1.VgFullscreenAPI.videogularElement = { id: 'vgElem' };
        spyOn(vg_fullscreen_api_1.VgFullscreenAPI, 'request').and.callFake(function () { });
        vg_fullscreen_api_1.VgFullscreenAPI.toggleFullscreen(element);
        expect(vg_fullscreen_api_1.VgFullscreenAPI.request).toHaveBeenCalledWith(element);
    });
    it('Should exit from fullscreen mode', function () {
        vg_fullscreen_api_1.VgFullscreenAPI.isFullscreen = true;
        spyOn(vg_fullscreen_api_1.VgFullscreenAPI, 'exit').and.callFake(function () { });
        vg_fullscreen_api_1.VgFullscreenAPI.toggleFullscreen();
        expect(vg_fullscreen_api_1.VgFullscreenAPI.exit).toHaveBeenCalled();
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmctZnVsbHNjcmVlbi1hcGkuc3BlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInZnLWZ1bGxzY3JlZW4tYXBpLnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHFCQUF3QixlQUFlLENBQUMsQ0FBQTtBQUN4QyxrQ0FBOEIscUJBQXFCLENBQUMsQ0FBQTtBQUVwRCx5QkFBc0IsWUFBWSxDQUFDLENBQUE7QUFFbkMsUUFBUSxDQUFDLG1CQUFtQixFQUFFO0lBQzFCLElBQUksTUFBcUIsQ0FBQztJQUMxQixJQUFJLElBQWdCLENBQUM7SUFFckIsVUFBVSxDQUFDO1FBQ1AsTUFBTSxHQUFHLElBQUksZ0JBQVMsRUFBRSxDQUFDO1FBQ3pCLElBQUksR0FBZ0I7WUFDaEIsdUJBQXVCLEVBQUUsY0FBTyxDQUFDO1NBQ3BDLENBQUM7UUFFRixtQ0FBZSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7UUFDbkMsbUNBQWUsQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7UUFDeEMsbUNBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLGlDQUFpQyxFQUFFO1FBQ2xDLE1BQU0sQ0FBQyxtQ0FBZSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUMsQ0FBQztRQUN6RSxNQUFNLENBQUMsbUNBQWUsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLENBQUM7UUFDekUsTUFBTSxDQUFDLG1DQUFlLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1FBQ3pFLE1BQU0sQ0FBQyxtQ0FBZSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUNuRSxNQUFNLENBQUMs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InNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7UXVlcnlMaXN0fSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHtWZ0Z1bGxzY3JlZW5BUEl9IGZyb20gXCIuL3ZnLWZ1bGxzY3JlZW4tYXBpXCI7XG5pbXBvcnQge1ZnTWVkaWF9IGZyb20gXCIuLi92Zy1tZWRpYS92Zy1tZWRpYVwiO1xuaW1wb3J0IHtWZ1V0aWxzfSBmcm9tIFwiLi92Zy11dGlsc1wiO1xuXG5kZXNjcmliZSgnVmlkZW9ndWxhciBQbGF5ZXInLCAoKSA9PiB7XG4gICAgbGV0IG1lZGlhczpRdWVyeUxpc3Q8YW55PjtcbiAgICBsZXQgZWxlbTpIVE1MRWxlbWVudDtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICBtZWRpYXMgPSBuZXcgUXVlcnlMaXN0KCk7XG4gICAgICAgIGVsZW0gPSA8SFRNTEVsZW1lbnQ+e1xuICAgICAgICAgICAgd2Via2l0UmVxdWVzdEZ1bGxzY3JlZW46ICgpID0+IHt9XG4gICAgICAgIH07XG5cbiAgICAgICAgVmdGdWxsc2NyZWVuQVBJLmlzQXZhaWxhYmxlID0gdHJ1ZTtcbiAgICAgICAgVmdGdWxsc2NyZWVuQVBJLm5hdGl2ZUZ1bGxzY3JlZW4gPSB0cnVlO1xuICAgICAgICBWZ0Z1bGxzY3JlZW5BUEkuaW5pdChlbGVtLCBtZWRpYXMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ1Nob3VsZCBjcmVhdGUgcG9seWZpbGxzIG9uIGluaXQnLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdChWZ0Z1bGxzY3JlZW5BUEkucG9seWZpbGwuZW5hYmxlZCkudG9CZSgnd2Via2l0RnVsbHNjcmVlbkVuYWJsZWQnKTtcbiAgICAgICAgZXhwZWN0KFZnRnVsbHNjcmVlbkFQSS5wb2x5ZmlsbC5lbGVtZW50KS50b0JlKCd3ZWJraXRGdWxsc2NyZWVuRWxlbWVudCcpO1xuICAgICAgICBleHBlY3QoVmdGdWxsc2NyZWVuQVBJLnBvbHlmaWxsLnJlcXVlc3QpLnRvQmUoJ3dlYmtpdFJlcXVlc3RGdWxsc2NyZWVuJyk7XG4gICAgICAgIGV4cGVjdChWZ0Z1bGxzY3JlZW5BUEkucG9seWZpbGwuZXhpdCkudG9CZSgnd2Via2l0RXhpdEZ1bGxzY3JlZW4nKTtcbiAgICAgICAgZXhwZWN0KFZnRnVsbHNjcmVlbkFQSS5wb2x5ZmlsbC5vbmNoYW5nZSkudG9CZSgnd2Via2l0ZnVsbHNjcmVlbmNoYW5nZScpO1xuICAgICAgICBleHBlY3QoVmdGdWxsc2NyZWVuQVBJLnBvbHlmaWxsLm9uZXJyb3IpLnRvQmUoJ3dlYmtpdGZ1bGxzY3JlZW5lcnJvcicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ1Nob3VsZCByZXF1ZXN0IGFuIGVsZW1lbnQgdG8gZW50ZXIgaW4gZnVsbHNjcmVlbiBtb2RlIChkZXNrdG9wKScsICgpID0+IHtcbiAgICAgICAgc3B5T24oVmdGdWxsc2NyZWVuQVBJLCAnZW50ZXJFbGVtZW50SW5GdWxsU2NyZWVuJykuYW5kLmNhbGxGYWtlKCgpID0+IHt9KTtcblxuICAgICAgICBWZ0Z1bGxzY3JlZW5BUEkucmVxdWVzdChudWxsKTtcblxuICAgICAgICBleHBlY3QoVmdGdWxsc2NyZWVuQVBJLmlzRnVsbHNjcmVlbikudG9CZVRydXRoeSgpO1xuICAgICAgICBleHBlY3QoVmdGdWxsc2NyZWVuQVBJLmVudGVyRWxlbWVudEluRnVsbFNjcmVlbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoZWxlbSk7XG4gICAgfSk7XG5cbiAgICBpdCgnU2hvdWxkIHJlcXVlc3QgYW4gZWxlbWVudCB0byBlbnRlciBpbiBmdWxsc2NyZWVuIG1vZGUgKG1vYmlsZSknLCAoKSA9PiB7XG4gICAgICAgIHNweU9uKFZnVXRpbHMsICdpc01vYmlsZURldmljZScpLmFuZC5jYWxsRmFrZSgoKSA9PiB7cmV0dXJuIHRydWU7fSk7XG4gICAgICAgIHNweU9uKFZnRnVsbHNjcmVlbkFQSSwgJ2VudGVyRWxlbWVudEluRnVsbFNjcmVlbicpLmFuZC5jYWxsRmFrZSgoKSA9PiB7fSk7XG5cbiAgICAgICAgVmdGdWxsc2NyZWVuQVBJLnJlcXVlc3QobnVsbCk7XG5cbiAgICAgICAgZXhwZWN0KFZnRnVsbHNjcmVlbkFQSS5pc0Z1bGxzY3JlZW4pLnRvQmVUcnV0aHkoKTtcbiAgICAgICAgZXhwZWN0KFZnVXRpbHMuaXNNb2JpbGVEZXZpY2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgZXhwZWN0KFZnRnVsbHNjcmVlbkFQSS5lbnRlckVsZW1lbnRJbkZ1bGxTY3JlZW4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGVsZW0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ1Nob3VsZCByZXF1ZXN0IGFuIGVsZW1lbnQgdG8gZW50ZXIgaW4gZnVsbHNjcmVlbiBtb2RlIChtb2JpbGUgd2l0aCBwYXJhbSBlbGVtKScsICgpID0+IHtcbiAgICAgICAgc3B5T24oVmdVdGlscywgJ2lzTW9iaWxlRGV2aWNlJykuYW5kLmNhbGxGYWtlKCgpID0+IHtyZXR1cm4gdHJ1ZTt9KTtcbiAgICAgICAgc3B5T24oVmdGdWxsc2NyZWVuQVBJLCAnZW50ZXJFbGVtZW50SW5GdWxsU2NyZWVuJykuYW5kLmNhbGxGYWtlKCgpID0+IHt9KTtcblxuICAgICAgICBWZ0Z1bGxzY3JlZW5BUEkucmVxdWVzdChlbGVtKTtcblxuICAgICAgICBleHBlY3QoVmdGdWxsc2NyZWVuQVBJLmlzRnVsbHNjcmVlbikudG9CZVRydXRoeSgpO1xuICAgICAgICBleHBlY3QoVmdVdGlscy5pc01vYmlsZURldmljZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICBleHBlY3QoVmdGdWxsc2NyZWVuQVBJLmVudGVyRWxlbWVudEluRnVsbFNjcmVlbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoZWxlbSk7XG4gICAgfSk7XG5cbiAgICBpdCgnU2hvdWxkIG5vdCByZXF1ZXN0IGFuIGVsZW1lbnQgdG8gZW50ZXIgaW4gZnVsbHNjcmVlbiBtb2RlJywgKCkgPT4ge1xuICAgICAgICBzcHlPbihWZ0Z1bGxzY3JlZW5BUEksICdlbnRlckVsZW1lbnRJbkZ1bGxTY3JlZW4nKS5hbmQuY2FsbEZha2UoKCkgPT4ge30pO1xuXG4gICAgICAgIFZnRnVsbHNjcmVlbkFQSS5uYXRpdmVGdWxsc2NyZWVuID0gZmFsc2U7XG4gICAgICAgIFZnRnVsbHNjcmVlbkFQSS5yZXF1ZXN0KGVsZW0pO1xuXG4gICAgICAgIGV4cGVjdChWZ0Z1bGxzY3JlZW5BUEkuZW50ZXJFbGVtZW50SW5GdWxsU2NyZWVuKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ1Nob3VsZCBlbnRlciBpbiBmdWxsc2NyZWVuIG1vZGUnLCAoKSA9PiB7XG4gICAgICAgIHNweU9uKDxhbnk+ZWxlbSwgJ3dlYmtpdFJlcXVlc3RGdWxsc2NyZWVuJykuYW5kLmNhbGxUaHJvdWdoKCk7XG5cbiAgICAgICAgVmdGdWxsc2NyZWVuQVBJLmVudGVyRWxlbWVudEluRnVsbFNjcmVlbihlbGVtKTtcblxuICAgICAgICBleHBlY3QoKDxhbnk+ZWxlbSkud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdTaG91bGQgcmVxdWVzdCBhbiBlbGVtZW50IHRvIGV4aXQgZnJvbSBmdWxsc2NyZWVuIG1vZGUgKG5hdGl2ZSknLCAoKSA9PiB7XG4gICAgICAgIFZnRnVsbHNjcmVlbkFQSS5wb2x5ZmlsbC5leGl0ID0gJ21vY2tlZEV4aXRGdW5jdGlvbic7XG5cbiAgICAgICAgKDxhbnk+ZG9jdW1lbnQpLm1vY2tlZEV4aXRGdW5jdGlvbiA9ICgpID0+IHt9O1xuXG4gICAgICAgIHNweU9uKGRvY3VtZW50LCAnbW9ja2VkRXhpdEZ1bmN0aW9uJykuYW5kLmNhbGxUaHJvdWdoKCk7XG5cbiAgICAgICAgVmdGdWxsc2NyZWVuQVBJLmV4aXQoKTtcblxuICAgICAgICBleHBlY3QoVmdGdWxsc2NyZWVuQVBJLmlzRnVsbHNjcmVlbikudG9CZUZhbHN5KCk7XG4gICAgICAgIGV4cGVjdCgoPGFueT5kb2N1bWVudCkubW9ja2VkRXhpdEZ1bmN0aW9uKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnU2hvdWxkIHJlcXVlc3QgYW4gZWxlbWVudCB0byBleGl0IGZyb20gZnVsbHNjcmVlbiBtb2RlIChlbXVsYXRlZCknLCAoKSA9PiB7XG4gICAgICAgIFZnRnVsbHNjcmVlbkFQSS5wb2x5ZmlsbC5leGl0ID0gJ21vY2tlZEV4aXRGdW5jdGlvbic7XG5cbiAgICAgICAgKDxhbnk+ZG9jdW1lbnQpLm1vY2tlZEV4aXRGdW5jdGlvbiA9ICgpID0+IHt9O1xuXG4gICAgICAgIHNweU9uKGRvY3VtZW50LCAnbW9ja2VkRXhpdEZ1bmN0aW9uJykuYW5kLmNhbGxUaHJvdWdoKCk7XG5cbiAgICAgICAgVmdGdWxsc2NyZWVuQVBJLm5hdGl2ZUZ1bGxzY3JlZW4gPSBmYWxzZTtcbiAgICAgICAgVmdGdWxsc2NyZWVuQVBJLmV4aXQoKTtcblxuICAgICAgICBleHBlY3QoVmdGdWxsc2NyZWVuQVBJLmlzRnVsbHNjcmVlbikudG9CZUZhbHN5KCk7XG4gICAgICAgIGV4cGVjdCgoPGFueT5kb2N1bWVudCkubW9ja2VkRXhpdEZ1bmN0aW9uKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ1Nob3VsZCBlbnRlciB2aWRlb2d1bGFyIGVsZW1lbnQgdG8gZnVsbHNjcmVlbiBtb2RlJywgKCkgPT4ge1xuICAgICAgICBWZ0Z1bGxzY3JlZW5BUEkudmlkZW9ndWxhckVsZW1lbnQgPSA8SFRNTEVsZW1lbnQ+e2lkOiAndmdFbGVtJ307XG5cbiAgICAgICAgc3B5T24oVmdGdWxsc2NyZWVuQVBJLCAncmVxdWVzdCcpLmFuZC5jYWxsRmFrZSgoKSA9PiB7fSk7XG5cbiAgICAgICAgVmdGdWxsc2NyZWVuQVBJLnRvZ2dsZUZ1bGxzY3JlZW4oKTtcblxuICAgICAgICBleHBlY3QoVmdGdWxsc2NyZWVuQVBJLnJlcXVlc3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG51bGwpO1xuICAgIH0pO1xuXG4gICAgaXQoJ1Nob3VsZCBlbnRlciBvdGhlciBlbGVtZW50IHRvIGZ1bGxzY3JlZW4gbW9kZScsICgpID0+IHtcbiAgICAgICAgbGV0IGVsZW1lbnQgPSB7aWQ6ICdtYWluJ307XG5cbiAgICAgICAgVmdGdWxsc2NyZWVuQVBJLnZpZGVvZ3VsYXJFbGVtZW50ID0gPEhUTUxFbGVtZW50PntpZDogJ3ZnRWxlbSd9O1xuXG4gICAgICAgIHNweU9uKFZnRnVsbHNjcmVlbkFQSSwgJ3JlcXVlc3QnKS5hbmQuY2FsbEZha2UoKCkgPT4ge30pO1xuXG4gICAgICAgIFZnRnVsbHNjcmVlbkFQSS50b2dnbGVGdWxsc2NyZWVuKGVsZW1lbnQpO1xuXG4gICAgICAgIGV4cGVjdChWZ0Z1bGxzY3JlZW5BUEkucmVxdWVzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZWxlbWVudCk7XG4gICAgfSk7XG5cbiAgICBpdCgnU2hvdWxkIGV4aXQgZnJvbSBmdWxsc2NyZWVuIG1vZGUnLCAoKSA9PiB7XG4gICAgICAgIFZnRnVsbHNjcmVlbkFQSS5pc0Z1bGxzY3JlZW4gPSB0cnVlO1xuXG4gICAgICAgIHNweU9uKFZnRnVsbHNjcmVlbkFQSSwgJ2V4aXQnKS5hbmQuY2FsbEZha2UoKCkgPT4ge30pO1xuXG4gICAgICAgIFZnRnVsbHNjcmVlbkFQSS50b2dnbGVGdWxsc2NyZWVuKCk7XG5cbiAgICAgICAgZXhwZWN0KFZnRnVsbHNjcmVlbkFQSS5leGl0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG59KTtcblxuaW50ZXJmYWNlIERlY29yYXRvckludm9jYXRpb24ge1xuICB0eXBlOiBGdW5jdGlvbjtcbiAgYXJncz86IGFueVtdO1xufVxuIl19